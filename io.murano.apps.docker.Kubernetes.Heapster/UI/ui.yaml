Version: 2
Templates:
  influxdbPod:
    ?:
      type: io.murano.apps.docker.Kubernetes.POD
    name: 'cAdvisor'
    labels: {}
    kubernetes: $.appConfiguration.kubernetes
    replication: false
    replicationFactor: 0
    usePODDefinition: true
    podDefinition:
      apiVersion: "v1beta1"
      kind: "ReplicationController"
      id: "monitoring-influx-grafana-controller"
      desiredState:
        replicas: 1
        replicaSelector:
          name: "influxGrafana"
          usedby: "heapster"
          requiredby: "murano"
        podTemplate:
          labels:
            name: "influxGrafana"
            usedby: "heapster"
            requiredby: "murano"
          desiredState:
            manifest:
              version: "v1beta1"
              id: "monitoring-influx-grafana-controller"
              containers:
                - name: "influxdb"
                  image: "kubernetes/heapster_influxdb:v0.3"
                  ports:
                    - containerPort: 8083
                      hostPort: 8083
                    - containerPort: 8086
                      hostPort: 8086
                - name: "grafana"
                  image: "kubernetes/heapster_grafana:v0.3"
                  ports:
                    - containerPort: 80
                      hostPort: 80
                  env:
                    - name: "HTTP_USER"
                      value: "admin"
                    - name: "HTTP_PASS"
                      value: "**None**"
      labels:
        name: "influxGrafana"

  influxdbService:
    ?:
      type: io.murano.apps.docker.Kubernetes.Service
    name: 'monitoring-influxdb'
    kubernetes: $.appConfiguration.kubernetes
    port:  80
    enabled: true
    containerPort: 8086
    externalLB: false
    selector:
      name: "influxGrafana"
      usedby: "heapster"
      requiredby: "murano"


  heapsterPod:
    ?:
      type: io.murano.apps.docker.Kubernetes.POD
    name: 'heapster'
    labels: {}
    kubernetes: $.appConfiguration.kubernetes
    replication: false
    replicationFactor: 0
    usePODDefinition: true
    podDefinition:
      apiVersion: "v1beta1"
      id: "monitoring-heapster-controller"
      kind: "ReplicationController"
      desiredState:
        replicas: 1
        replicaSelector:
          name: "heapster"
        podTemplate:
          desiredState:
            manifest:
              version: "v1beta1"
              id: "monitoring-heapster-controller"
              containers:
                -
                  name: "heapster"
                  image: "kubernetes/heapster:v0.6"
                  env:
                    -
                      name: "INFLUXDB_HOST"
                      value: "monitoring-influxdb"
          labels:
            name: "heapster"
            uses: "monitoring-influxdb"
      labels:
        name: "heapster"

Application:
  ?:
    type: io.murano.apps.docker.Kubernetes.Heapster
  name: 'heapster'
  influxdbPod: $influxdbPod
  influxService: $influxdbService
  heapsterPod: $heapsterPod


Forms:
  - appConfiguration:
      fields:
        - name: name
          type: string
          label: Application Name
          initial: 'cAdvisor'
          description: >-
            Enter a desired name for the application. Just A-Z, a-z, 0-9, dash and
            underline are allowed
        - name: kubernetes
          type: io.murano.apps.docker.Kubernetes
          label: Kubernetes cluster
          required: true
          description: >-
            Kubernetes service
